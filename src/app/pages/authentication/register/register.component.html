<div class="auth-main">
  <div class="auth-wrapper v3">
    <div class="auth-form" [class.night-mode]="isNightTime">
      <div class="card">
        <div class="card-body">
          <a href="#" class="d-flex justify-content-center">
            <img id="logo" src="../../../../assets/images/logo.svg" alt="logo" />
          </a>

          <div class="row">
            <div class="d-flex justify-content-center">
              <div class="auth-header">
                <h2 class="text-secondary mt-4"><b>¡Crea Tu Cuenta!</b></h2>
                <p class="fs-4 mt-2">Únete y comienza tu aventura:</p>
              </div>
            </div>
          </div>

          <div class="d-grid">
            <button
              type="button"
              class="btn mt-2 bg-white text-muted d-flex justify-content-center align-items-center"
              (click)="registerWithGoogle()"
            >
              <div class="me-md-4">
                <img class="icon" src="../../../../assets/images/authentication/google-icon.svg" alt="google" />
                <span>Regístrate Con Google</span>
              </div>
            </button>

            <button type="button" class="btn mt-2 bg-purple text-white d-flex justify-content-center align-items-center">
              <div class="me-md-3">
                <img class="icon" src="../../../../assets/images/authentication/github-icon.svg" alt="github" />
                <span>Regístrate Con GitHub</span>
              </div>
            </button>

            <button type="button" class="btn mt-2 bg-blue text-white d-flex justify-content-center align-items-center">
              <div class="ms-md-3">
                <img class="icon" src="../../../../assets/images/authentication/microsoft-icon.svg" alt="microsoft" />
                <span>Regístrate Con Microsoft</span>
              </div>
            </button>
          </div>

          <div class="mt-2 justify-content-center d-flex">
            <span>o</span>
          </div>

          <h5 class="my-3 d-flex justify-content-center"><b>Regístrate con tu correo electrónico:</b></h5>

          <form #registerForm="ngForm" novalidate (ngSubmit)="startRegistration(registerForm)">
            <!-- Campo de Nombre -->
            <div class="form-floating mb-3">
              <input type="text"
                     class="form-control"
                     id="name"
                     name="name"
                     placeholder="Tu nombre"
                     required
                     minlength="3"
                     maxlength="50"
                     [(ngModel)]="registerData.name"
                     #nameRef="ngModel"
                     [class.is-invalid]="nameRef.invalid && nameRef.touched"/>
              <label for="name">Nombre Completo</label>

              @if (nameRef.invalid && nameRef.touched) {
                <div class="text-danger small mt-1">
                  @if (nameRef.errors?.['required']) {
                    El nombre es requerido
                  }
                  @if (nameRef.errors?.['minlength']) {
                    Mínimo 3 caracteres
                  }
                  @if (nameRef.errors?.['maxlength']) {
                    Máximo 50 caracteres
                  }
                </div>
              }
            </div>

            <!-- Campo de Email -->
            <div class="form-floating mb-3">
              <input type="email"
                     class="form-control"
                     id="email"
                     name="email"
                     placeholder="email@ejemplo.com"
                     required
                     pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
                     [(ngModel)]="registerData.email"
                     #emailRef="ngModel"
                     [class.is-invalid]="emailRef.invalid && emailRef.touched"/>
              <label for="email">Correo Electrónico</label>

              @if (emailRef.invalid && emailRef.touched) {
                <div class="text-danger small mt-1">
                  @if (emailRef.errors?.['required']) {
                    El correo electrónico es requerido
                  }
                  @if (emailRef.errors?.['pattern']) {
                    Ingrese un correo electrónico válido
                  }
                </div>
              }
            </div>

            <!-- Campo de Contraseña -->
            <div class="form-floating mb-3">
              <input type="password"
                     class="form-control"
                     id="password"
                     name="password"
                     placeholder=""
                     required
                     minlength="8"
                     maxlength="15"
                     pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\[\]{};:,.<>?\\|`~\-=\/]).{8,15}$"
                     [(ngModel)]="registerData.password"
                     #passwordRef="ngModel"
                     [class.is-invalid]="passwordRef.invalid && passwordRef.touched"/>
              <label for="password">Contraseña</label>

              @if (passwordRef.invalid && passwordRef.touched) {
                <div class="text-danger small mt-1">
                  @if (passwordRef.errors?.['required']) {
                    La contraseña es requerida
                  }
                  @if (passwordRef.errors?.['minlength']) {
                    Mínimo 8 caracteres
                  }
                  @if (passwordRef.errors?.['maxlength']) {
                    Máximo 15 caracteres
                  }
                  @if (passwordRef.errors?.['pattern']) {
                    La contraseña debe tener al menos una mayúscula, una minúscula, un número y un carácter especial
                  }
                </div>
              }
            </div>

            <!-- Campo de Confirmar Contraseña -->
            <div class="form-floating mb-3">
              <input type="password"
                     class="form-control"
                     id="confirmPassword"
                     name="confirmPassword"
                     placeholder=""
                     required
                     [(ngModel)]="registerData.confirmPassword"
                     #confirmPasswordRef="ngModel"
                     [class.is-invalid]="confirmPasswordRef.invalid && confirmPasswordRef.touched"/>
              <label for="confirmPassword">Confirmar Contraseña</label>

              @if (confirmPasswordRef.invalid && confirmPasswordRef.touched) {
                <div class="text-danger small mt-1">
                  @if (confirmPasswordRef.errors?.['required']) {
                    Debes confirmar tu contraseña
                  }
                </div>
              }
              @if (registerData.password !== registerData.confirmPassword && confirmPasswordRef.touched) {
                <div class="text-danger small mt-1">
                  Las contraseñas no coinciden
                </div>
              }
            </div>

            <div class="form-check mt-3">
              <input class="form-check-input input-primary" type="checkbox" id="terms" required />
              <label class="form-check-label text-muted" for="terms">
                Acepto los <a href="javascript:">Términos y Condiciones</a>
              </label>
            </div>

            <div class="d-grid mt-4">
              <button type="submit" class="btn btn-secondary">Crear Cuenta</button>
            </div>
          </form>

          <h5 class="d-flex justify-content-center mt-3">
            <a [routerLink]="['/login']">¿Ya Tienes Una Cuenta?</a>
          </h5>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Verificación OTP -->
<dialog #verifModal class="verifModal">
  <h2>Código de verificación</h2>

  <p>Por favor, ingresa el código que hemos enviado a tu correo electrónico:</p>
  <p class="email-highlight">{{this.registerData.email}}</p>

  <div class="code-inputs">
    <input type="text"
           maxlength="1"
           class="code-input"
           #input1
           (input)="onCodeInput($event, 1)"
           (keydown)="onKeyDown($event, 0)"
           [(ngModel)]="verificationCode[0]">
    <input type="text"
           maxlength="1"
           class="code-input"
           #input2
           (input)="onCodeInput($event, 2)"
           (keydown)="onKeyDown($event, 1)"
           [(ngModel)]="verificationCode[1]">
    <input type="text"
           maxlength="1"
           class="code-input"
           #input3
           (input)="onCodeInput($event, 3)"
           (keydown)="onKeyDown($event, 2)"
           [(ngModel)]="verificationCode[2]">
    <input type="text"
           maxlength="1"
           class="code-input"
           #input4
           (input)="onCodeInput($event, 4)"
           (keydown)="onKeyDown($event, 3)"
           [(ngModel)]="verificationCode[3]">
    <input type="text"
           maxlength="1"
           class="code-input"
           #input5
           (input)="onCodeInput($event, 5)"
           (keydown)="onKeyDown($event, 4)"
           [(ngModel)]="verificationCode[4]">
    <input type="text"
           maxlength="1"
           class="code-input"
           #input6
           (input)="onCodeInput($event, 6)"
           (keydown)="onKeyDown($event, 5)"
           [(ngModel)]="verificationCode[5]">
  </div>

  <button type="button" class="btn bg-purple text-white mt-4" (click)="verifyCode()">
    Verificar Código
  </button>

  <button type="button" class="btn btn-outline-secondary mt-2" (click)="closeModal()">
    Cancelar
  </button>
</dialog>

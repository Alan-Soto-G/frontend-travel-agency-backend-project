<main>
  <div class="container mt-4">
    <!-- Header con t√≠tulo y bot√≥n crear -->
    <div id="head">
      <h2 class="mb-4">{{typeOfCrud}}</h2>
      <button class="btn btn-primary mb-3" (click)="handleActionClick('create')">
        Crear {{ typeOfCrud.slice(0, -lenSlice) }}
      </button>
    </div>

    <!-- Barra de b√∫squeda -->
    <div class="search-container mb-3">
      <div class="search-wrapper">
        <input
          type="text"
          class="form-control search-input"
          placeholder="üîç Buscar en la tabla..."
          [(ngModel)]="searchText"
          (input)="onSearchChange()"
          autocomplete="off">
        <button
          *ngIf="searchText"
          class="btn btn-sm btn-clear"
          (click)="searchText = ''; onSearchChange()"
          title="Limpiar b√∫squeda">
          √ó
        </button>
      </div>
    </div>

    <!-- Informaci√≥n de resultados -->
    <div class="info-bar mb-3">
      @if (filteredData.length > 0) {
        <p class="results-info">
          Mostrando {{ (currentPage - 1) * itemsPerPage + 1 }} -
          {{ Math.min(currentPage * itemsPerPage, filteredData.length) }}
          de {{ filteredData.length }}
          {{ typeOfCrud.slice(0, -lenSlice+1) }}
          @if (searchText) {
            <span class="search-badge">(Filtrados de {{ data.length }} totales)</span>
          }
        </p>
      } @else if (searchText) {
        <p class="no-results">No se encontraron resultados para "{{ searchText }}"</p>
      } @else {
        <p class="no-results">No hay registros disponibles</p>
      }
    </div>

    <!-- Tabla responsive -->
    <div class="table-responsive">
      <table class="table table-bordered table-hover" *ngIf="paginatedData.length > 0">
        <thead class="thead-light">
          <tr id="headTable">
            <th *ngFor="let col of headTable">{{ col | titlecase }}</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let row of paginatedData" id="bodyTable">
            <td *ngFor="let col of itemsData" [attr.data-label]="headTable[itemsData.indexOf(col)]">
              {{ getNestedValue(row, col) }}
            </td>
                
            <td data-label="Carrito" *ngIf="showCartButton">
              <button 
                class="btn btn-sm btn-cart" 
                (click)="handleCartClick(row)"
                [disabled]="row.status !== 'active' || row.availableSeats === 0"
                title="Agregar al carrito">
                <span class="d-none d-md-inline">üõí Carrito</span>
                <span class="d-md-none">üõí</span>
              </button>
            </td>
            <td data-label="Editar">
              <button class="btn btn-sm btn-info" (click)="handleActionClick('edit', row._id || row.id)">
                <span class="d-none d-md-inline">Edit</span>
                <span class="d-md-none">‚úèÔ∏è</span>
              </button>
            </td>
            <td data-label="Eliminar">
              <button class="btn btn-sm btn-danger" (click)="handleActionClick('delete', row._id || row.id)">
                <span class="d-none d-md-inline">Delete</span>
                <span class="d-md-none">üóëÔ∏è</span>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginaci√≥n -->
    <nav *ngIf="totalPages > 1" class="pagination-container" aria-label="Navegaci√≥n de p√°ginas">
      <ul class="pagination justify-content-center">
        <!-- Bot√≥n anterior -->
        <li class="page-item" [class.disabled]="currentPage === 1">
          <button class="page-link" (click)="previousPage()" [disabled]="currentPage === 1">
            <span class="d-none d-sm-inline">Anterior</span>
            <span class="d-sm-none">‚Äπ</span>
          </button>
        </li>

        <!-- Primera p√°gina -->
        <li class="page-item" *ngIf="getPageNumbers()[0] > 1">
          <button class="page-link" (click)="goToPage(1)">1</button>
        </li>
        <li class="page-item disabled" *ngIf="getPageNumbers()[0] > 2">
          <span class="page-link">...</span>
        </li>

        <!-- P√°ginas numeradas -->
        <li class="page-item"
            *ngFor="let page of getPageNumbers()"
            [class.active]="page === currentPage">
          <button class="page-link" (click)="goToPage(page)">
            {{ page }}
          </button>
        </li>

        <!-- √öltima p√°gina -->
        <li class="page-item disabled" *ngIf="getPageNumbers()[getPageNumbers().length - 1] < totalPages - 1">
          <span class="page-link">...</span>
        </li>
        <li class="page-item" *ngIf="getPageNumbers()[getPageNumbers().length - 1] < totalPages">
          <button class="page-link" (click)="goToPage(totalPages)">{{ totalPages }}</button>
        </li>

        <!-- Bot√≥n siguiente -->
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <button class="page-link" (click)="nextPage()" [disabled]="currentPage === totalPages">
            <span class="d-none d-sm-inline">Siguiente</span>
            <span class="d-sm-none">‚Ä∫</span>
          </button>
        </li>
      </ul>

      <!-- Info de p√°gina en m√≥viles -->
      <div class="page-info d-md-none text-center mt-2">
        P√°gina {{ currentPage }} de {{ totalPages }}
      </div>
    </nav>
  </div>
</main>

<app-modal-crud
  [title]="titleModal"
  [message]="messageModal"
  [typeService]="typeServiceModal"
  [textButton]="textButtonModal"
  [fields]="fields"
  [formData]="formDataModal"
  (formSubmitted)="onFormSubmitted($event)"
></app-modal-crud>
